name: Release
on: [push]

jobs:
  get-package-version:
    runs-on: ubuntu-latest
    steps:
      - name: get package version
        id: package-version
        uses: martinbeentjes/npm-get-version-action@master
    outputs:
      package-version: ${{ steps.package-version.outputs.current-version }}

  build:
    needs: [get-package-version]
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: setup node
        uses: actions/setup-node@v2
          with:
            node-version: 14
      - name: install dependencies
        run: npm ci
      - name: install pkg
        run: npm install -D pkg
      - name: build
        run: npm run build-${{ matrix.os }}
      - name: add to release
        uses: softprops/action-gh-release@v1
        with:
          files: build/bin/cithak.*
          draft: true
          tag_name: v${{ needs.get-package-version.outputs.package-version }}